code architecture:


app                 +-------------------------+
                    |    Camera app           |
                    +-------------------------+
                                ^
                                |
 -------------------------------+---------------------------------------------------
                                v
framwork          +------------------------------+
                  |       Camera.java            |    +--------------+
                  | android_hardware_Camera.cpp  |    |    jni       |
                  +------------------------------+    +--------------+
                                ^                    
                                |
                                v
                  +------------------------------+     +---------------+
                  |        Camera.cpp            |     | Camera client |
                  +------------------------------+     +---------------+
                                ^
                                |
                                |+-----------+
                                || binder    |
                                |+-----------+
                                |
                                v                  
                  +-------------------------------+
                  |     CameraService.cpp         |     +----------------+
                  |    CameraDeviceClient.cpp     |     | Camera service |
                  |     Camera3Device.cpp         |     +----------------+
                  +-------------------------------+
                                ^
                                |
                                |
 -------------------------------+---------------------------------------------------
                                v
 Hal               +------------------------------+
                   |    SprdCamera3Hal.cpp        |   通过此文件对上向camera注册对应实现
                   +------------------------------+
                                ^
                                |
                                v
                   +------------------------------+
                   |    SprdCamera3HWI.cpp        |
                   |     Hal层对上提供的接口      |
                   +------------------------------+
                     ^           ^                 ^
                     |           |                 |
                     |           |                 |
                     v           v                 v
+----------------------+  +----------------------+  +----------------------+
|SprdCamera3Setting.cpp|  |SprdCamera3Channel.cpp|  |SprdCamera3Stream.cpp |
|设置相关操作的实现    |  |  通道的抽象          |  |   流的抽象           |
+----------------------+  +----------------------+  +----------------------+
                      ^          ^                  ^
                      |          |                  |
                      |          |                  |
                      v          v                  v
                     +-----------------------------+
                     |   SprdCamera3OEMIf.cpp      |
                     |     具体调用oem层的实现     |
                     +-----------------------------+
                                 ^
                                 |
 --------------------------------+---------------------------------------------------
                                 |
                                 v
Oem                  +-----------------------------+
                     |      SprdOEMCamera.c        |
                     |     对hal直接提供的接口     |
                     +-----------------------------+ 
                                 ^ 
                                 | 
                                 v 
                     +------------------------------+
                     |         cmr_oem.c            |
    +--------------->|      具体oem内部实现接口     |<----------+
    |                +------------------------------+           |
    |                   ^      ^   ^              ^             |
    |                   |      |   |              |             |
    |                   v      |   |              |             |
    |      +--------------+    |   |              |             |
    |      |cmr_snapshot.c|    |   |              |             |
    |      |Snapshot的实现|    |   |              v             |
    |      +--------------+<---|---|-------->+--------------+   |
    |                          |   |  +----->|cmr_setting.c |   |
    |      +---------------+ <-+   |  | +--->| 设置接口     |   |
    |      |cmr_preview.c  |<------|--+ | +->+--------------+   |
    |      |Preview相关实现|       |    | |       ^             |
    |      +---------------+       |    | |       |             v
    |                              |    | |  +----v-------------------+
    |                              |    | |  |cmr_sensor.c            |
    |  +------------------------+<-+    | |  |对上关于sensor的接口实现|
    |  |cmr_rotate.c/cmr_scale.c|<------+ |  +------------------------+
    |  |  Rotate,scale的实现    |         |       ^
    |  +------------------------+         |       |
    |                                     |       v
    |                                     |  +------------------------------------+
    |      +---------------+              |  |  sensor_drv_u.c                    |
    +----->| cmr_grab.c    |<-------------+  | 向cmr_sensor.c提供操作sensor的接口 |
           | 数据抓取的实现|                 +------------------------------------+
           +---------------+                   ^                       ^
                ^                              |                       |
                |                              |                       v
                |                              |               +----------------------+
                |                              |               | sensor_cfg.c         |
                |                              |               | 向上注册支持的sensor |
                |                              |               +----------------------+
                |                              |                       ^
                |                              |                       |
                |                              |                       v
                |                              |               +-------------------------------+
                |                              |               |sensor/sensor_ov5648_mipi_raw.c|
                |                              |               |具体sensor相关操作实现         |
                |                              |               +-------------------------------+
                |                              |
                |+------------------+          v    +------------------------+
----------------|| read/write/ioctl |---------------| i2c寄存器读写和电源操作|-------------------
                |+------------------+               +------------------------+
                |
 kernel         |
                v
+------------------------------------+  +------------------------+
|     /dev/sprd_image                |  |   /dev/sprd_sensor     |
|由硬件中断产生数据供给cmr_grab.c采集|  |  操作寄存器读写和power |
+------------------------------------+  +------------------------+


